{
	"info": {
		"_postman_id": "4f9c6c16-aaf8-4cf4-8bab-f82638c072fb",
		"name": "SearchController Integration Tests",
		"description": "Integration tests for employee search functionality",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json",
		"_exporter_id": "48205789"
	},
	"item": [
		{
			"name": "Get Admin Token",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test(\"Admin login successful\", function () {",
							"    pm.expect(pm.response.code).to.equal(200);",
							"    pm.environment.set(\"adminToken\", pm.response.json().token);",
							"});"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Content-Type",
						"value": "application/json"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\"username\":\"{{adminUsername}}\",\"password\":\"{{adminPassword}}\"}"
				},
				"url": {
					"raw": "{{baseUrl}}/auth/login",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"auth",
						"login"
					]
				}
			},
			"response": []
		},
		{
			"name": "Search - By First Name",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test(\"Status code is 200\", function () {",
							"    pm.response.to.have.status(200);",
							"});",
							"",
							"pm.test(\"Returns matching employee\", function () {",
							"    const responseJson = pm.response.json();",
							"    pm.expect(responseJson[0].firstName).to.equal(\"Alice\");",
							"});"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Content-Type",
						"value": "application/json"
					},
					{
						"key": "Authorization",
						"value": "Bearer {{adminToken}}"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\"name\":\"Alice\"}"
				},
				"url": {
					"raw": "{{baseUrl}}/api/search/employees",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"api",
						"search",
						"employees"
					]
				}
			},
			"response": []
		},
		{
			"name": "Search - Substring Match",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test(\"Status code is 200\", function () {",
							"    pm.response.to.have.status(200);",
							"});",
							"",
							"pm.test(\"Returns matching employee\", function () {",
							"    const responseJson = pm.response.json();",
							"    pm.expect(responseJson[0].firstName).to.equal(\"Alice\");",
							"});"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Content-Type",
						"value": "application/json"
					},
					{
						"key": "Authorization",
						"value": "Bearer {{adminToken}}"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\"name\":\"Ali\"}"
				},
				"url": {
					"raw": "{{baseUrl}}/api/search/employees",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"api",
						"search",
						"employees"
					]
				}
			},
			"response": []
		},
		{
			"name": "Search - Typo Tolerance",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test(\"Status code is 200\", function () {",
							"    pm.response.to.have.status(200);",
							"});",
							"",
							"pm.test(\"Returns matching employee despite typo\", function () {",
							"    const responseJson = pm.response.json();",
							"    pm.expect(responseJson[0].lastName).to.equal(\"Wonderland\");",
							"});"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Content-Type",
						"value": "application/json"
					},
					{
						"key": "Authorization",
						"value": "Bearer {{adminToken}}"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\"name\":\"Wunder\"}"
				},
				"url": {
					"raw": "{{baseUrl}}/api/search/employees",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"api",
						"search",
						"employees"
					]
				}
			},
			"response": []
		},
		{
			"name": "Search - By Last Name",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test(\"Status code is 200\", function () {",
							"    pm.response.to.have.status(200);",
							"});",
							"",
							"pm.test(\"Returns matching employee\", function () {",
							"    const responseJson = pm.response.json();",
							"    pm.expect(responseJson[0].firstName).to.equal(\"Alice\");",
							"});"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Content-Type",
						"value": "application/json"
					},
					{
						"key": "Authorization",
						"value": "Bearer {{adminToken}}"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\"name\":\"Wonderland\"}"
				},
				"url": {
					"raw": "{{baseUrl}}/api/search/employees",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"api",
						"search",
						"employees"
					]
				}
			},
			"response": []
		},
		{
			"name": "Search - Case Insensitive",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test(\"Status code is 200\", function () {",
							"    pm.response.to.have.status(200);",
							"});",
							"",
							"pm.test(\"Returns matching employee case insensitive\", function () {",
							"    const responseJson = pm.response.json();",
							"    pm.expect(responseJson[0].firstName).to.equal(\"Alice\");",
							"});"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Content-Type",
						"value": "application/json"
					},
					{
						"key": "Authorization",
						"value": "Bearer {{adminToken}}"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\"name\":\"WONDERLAND\"}"
				},
				"url": {
					"raw": "{{baseUrl}}/api/search/employees",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"api",
						"search",
						"employees"
					]
				}
			},
			"response": []
		},
		{
			"name": "Search - Short Query (Bad Request)",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test(\"Status code is 400\", function () {",
							"    pm.response.to.have.status(400);",
							"});"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Content-Type",
						"value": "application/json"
					},
					{
						"key": "Authorization",
						"value": "Bearer {{adminToken}}"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\"name\":\"Al\"}"
				},
				"url": {
					"raw": "{{baseUrl}}/api/search/employees",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"api",
						"search",
						"employees"
					]
				}
			},
			"response": []
		},
		{
			"name": "Search - No Match",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test(\"Status code is 200\", function () {",
							"    pm.response.to.have.status(200);",
							"});",
							"",
							"pm.test(\"Returns empty array\", function () {",
							"    const responseJson = pm.response.json();",
							"    pm.expect(responseJson.length).to.equal(0);",
							"});"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Content-Type",
						"value": "application/json"
					},
					{
						"key": "Authorization",
						"value": "Bearer {{adminToken}}"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\"name\":\"Nobody\"}"
				},
				"url": {
					"raw": "{{baseUrl}}/api/search/employees",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"api",
						"search",
						"employees"
					]
				}
			},
			"response": []
		},
		{
			"name": "Search - Pagination Test",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test(\"Status code is 200\", function () {",
							"    pm.response.to.have.status(200);",
							"});",
							"",
							"pm.test(\"Returns 5 employees on first page\", function () {",
							"    const responseJson = pm.response.json();",
							"    pm.expect(responseJson.length).to.equal(5);",
							"});",
							"",
							"// Test pagination for other pages",
							"const pages = [1, 2, 3];",
							"pages.forEach(page => {",
							"    pm.sendRequest({",
							"        url: pm.request.url.toString(),",
							"        method: 'POST',",
							"        header: pm.request.headers.toObject(),",
							"        body: {",
							"            mode: 'raw',",
							"            raw: JSON.stringify({",
							"                \"name\": \"Alice\",",
							"                \"page\": page,",
							"                \"size\": 5",
							"            })",
							"        }",
							"    }, (err, res) => {",
							"        if (err) {",
							"            console.error(err);",
							"            return;",
							"        }",
							"        const expectedSize = page < 3 ? 5 : 1;",
							"        pm.test(`Page ${page+1} has ${expectedSize} employees`, function () {",
							"            pm.expect(res.json().length).to.equal(expectedSize);",
							"        });",
							"    });",
							"});"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Content-Type",
						"value": "application/json"
					},
					{
						"key": "Authorization",
						"value": "Bearer {{adminToken}}"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\"name\":\"Alice\",\"page\":0,\"size\":5}"
				},
				"url": {
					"raw": "{{baseUrl}}/api/search/employees",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"api",
						"search",
						"employees"
					]
				}
			},
			"response": []
		}
	],
	"event": [
		{
			"listen": "prerequest",
			"script": {
				"type": "text/javascript",
				"packages": {},
				"exec": [
					""
				]
			}
		},
		{
			"listen": "test",
			"script": {
				"type": "text/javascript",
				"packages": {},
				"exec": [
					""
				]
			}
		}
	],
	"variable": [
		{
			"key": "baseUrl",
			"value": "http://localhost:8080/modfac"
		},
		{
			"key": "adminUsername",
			"value": "admin1"
		},
		{
			"key": "adminPassword",
			"value": "adminpass1"
		},
		{
			"key": "adminToken",
			"value": ""
		},
		{
			"key": "employeeId",
			"value": ""
		}
	]
}